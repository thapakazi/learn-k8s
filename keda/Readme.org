#+TITLE: Revising scaing with KEDA
#+DATE: Saturday, Jan 10 2026


* what we need
- a kind cluster
- kind k8s components
  - deploy keda
  - deploy nginx ingress controller
- an app with custom metrics (http request)
- stress testing(vagetta)
- autoscaling in action
  
** a cluster
#+begin_src bash
kind create cluster --name=learn-keda --config=kind.yaml
#+end_src

** deploy k8s components
*** setup nginx
nginx ingress controller is sun-setting in mar2026, lets explore gateway api next
#+begin_src bash
  # helm upgrade --install ingress-nginx ingress-nginx \
  #  --repo https://kubernetes.github.io/ingress-nginx \
  #  --namespace ingress-nginx --create-namespace 
  kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/kind/deploy.yaml
#+end_src

*** get keda
#+begin_src bash
    helm repo add kedacore https://kedacore.github.io/charts  
    helm repo update
    helm install keda kedacore/keda --namespace keda --create-namespace
#+end_src

*** get prometheus stack
#+begin_src bash
  helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
  helm repo add stable https://charts.helm.sh/stable
  helm repo update
  kubectl create namespace monitoring
  
  helm install kind-prometheus prometheus-community/kube-prometheus-stack \
    --namespace monitoring \
    --set prometheus.service.nodePort=30000 \
    --set prometheus.service.type=NodePort \
    --set grafana.service.nodePort=31000 \
    --set grafana.service.type=NodePort \
    --set alertmanager.service.nodePort=32000 \
    --set alertmanager.service.type=NodePort \
    --set prometheus-node-exporter.service.nodePort=32001 \
    --set prometheus-node-exporter.service.type=NodePort
#+end_src








*** deploy application
#+begin_src bash
 k apply -f basic 
#+end_src
*** hammer with vegetta
and check the pods... the scaledobject will bump up the hpa for your deployment
#+begin_src bash
  brew install vegetta

  echo 'GET http://podinfo.local/' | vegeta attack -duration=1m -rate=100| tee /tmp/results.bin|vegeta report
#+end_src
[[./demo.png]]
